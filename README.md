# üöÄ NASA Kafka Pet Project

Pet-–ø—Ä–æ–µ–∫—Ç –Ω–∞ Python —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Kafka**, **Postgres** –∏ observability-—Å—Ç–µ–∫–∞ (**Sentry + ELK**).

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:

- Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É  
- –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–±–æ—è–º (retry + exponential backoff)  
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π  
- –°–±–æ—Ä –ª–æ–≥–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫  

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

Producer ‚Üí Kafka ‚Üí Consumer ‚Üí Postgres
‚Üì
Filebeat ‚Üí Elasticsearch ‚Üí Kibana
‚Üì
Sentry


---

## üìå –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç

### üü¢ Producer (Python)

- –≤—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é —Ç–µ–º—É (`moon`, `mars`, `earth` –∏ —Ç.–¥.)
- –ø–æ–ª—É—á–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π `nasa_id` –∏–∑ NASA Images API
- –ø–æ–ª—É—á–∞–µ—Ç `image_url`
- –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Kafka topic `images`

–ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Kafka:

- –Ω–µ —Ç–µ—Ä—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ  
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç retry + exponential backoff  
- –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±—Ä–æ–∫–µ—Ä–∞  

---

### üîµ Consumer (Python)

- —á–∏—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ Kafka topic `images`
- —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ Postgres
- –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ `nasa_id`:
  - `UNIQUE`
  - `ON CONFLICT DO NOTHING`
- manual commit offsets (commit —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏)
- retry/backoff –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –∏ DB –æ—à–∏–±–∫–∞—Ö

---

### üìä Observability

- –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ **Sentry**
- –ª–æ–≥–∏ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **Filebeat**
- —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ **Elasticsearch**
- –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –≤ **Kibana**
- Kafka UI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–æ–ø–∏–∫–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π

---

## üß∞ –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Å—Ç–µ–∫

- Python (`kafka-python`, `requests`, `psycopg2`)
- Apache Kafka + Zookeeper
- PostgreSQL
- Elasticsearch + Kibana + Filebeat
- Kafka UI
- Sentry
- Docker Compose

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- app/ ‚Äì –∫–æ–¥ producer –∏ consumer
  
- docker/ ‚Äì docker-compose –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è observability


---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `docker/.env`:

env
SENTRY_DSN=
ENVIRONMENT=local
INTERVAL_SECONDS=30
QUERY=


–ü–æ—è—Å–Ω–µ–Ω–∏—è

- SENTRY_DSN ‚Äî DSN –ø—Ä–æ–µ–∫—Ç–∞ Sentry (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)
- ENVIRONMENT ‚Äî –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä local)
- INTERVAL_SECONDS ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏ producer
- QUERY ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞
- –µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–∞—è —Ç–µ–º–∞

‚ö†Ô∏è –§–∞–π–ª .env –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Git (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è .env.example).

‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
- –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É docker:
 cd docker

- –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
   docker compose up -d --build

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
  docker compose ps

üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- Kafka UI ‚Üí http://localhost:8080
- Kibana ‚Üí http://localhost:5601
- Elasticsearch ‚Üí http://localhost:9200
- Postgres ‚Üí localhost:5432

üß™ –¢–µ—Å—Ç-–∫–µ–π—Å—ã (–∫–∞–∫ QA)
1Ô∏è‚É£ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Kafka
docker compose stop kafka

–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- Producer –ø–∏—à–µ—Ç Kafka unavailable
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç retry + backoff
- –ù–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
- –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è Kafka –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "–∑–∞–≤–∏—Å—à–µ–µ" —Å–æ–æ–±—â–µ–Ω–∏–µ

–ó–∞–ø—É—Å–∫ –æ–±—Ä–∞—Ç–Ω–æ:
docker compose start kafka

2Ô∏è‚É£ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ / NASA API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
–û–∂–∏–¥–∞–µ–º:
1. Producer –Ω–µ –ø–∞–¥–∞–µ—Ç
2. –õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É
3. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ backoff

3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
–û–∂–∏–¥–∞–µ–º:
–ï—Å–ª–∏ –æ–¥–∏–Ω nasa_id –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ:
- –∑–∞–ø–∏—Å—å –≤ –ë–î –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è
- –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è–µ—Ç—Å—è duplicate skipped

4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
- docker compose logs -f producer
- docker compose logs -f consumer

–û–∂–∏–¥–∞–µ–º:
–õ–æ–≥–∏ —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Kibana.

üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –∫–∞–∫ pet-–ø—Ä–æ–µ–∫—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:
- –ø–æ–Ω–∏–º–∞–Ω–∏—è event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- —Ä–∞–±–æ—Ç—ã —Å Kafka
- –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–±–æ–µ–≤ –∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- observability –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
