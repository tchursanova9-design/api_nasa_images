### üìã  TEST REPORT

Project: NASA Kafka Pet Project

Tester: –¢–∞—Ç—å—è–Ω–∞ –í–∞—Ä–∞–∫–∏–Ω–∞

Environment: local (Docker Compose)

Stack: Kafka, Postgres, Sentry, ELK, Python

#### –¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã producer/consumer
- —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–±–æ—è–º Kafka
- —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–µ—Ç–µ–≤—ã–º —Å–±–æ—è–º
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å commit offsets
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ—Ç–µ—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏–π


### Test Cases

#### ‚úÖ TC-01: –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

–¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–π —Å—Ç–∞—Ä—Ç –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

–®–∞–≥–∏:
1. docker compose up -d --build
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å docker compose ps
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ producer –∏ consumer

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
1. –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Å—Ç–∞—Ç—É—Å–µ "UP"

![—Ç–µ—Å—Ç 1 .png](images/%D1%82%D0%B5%D1%81%D1%82%201%20.png)

3. Producer –ø–∏—à–µ—Ç "sent"

4. Consumer –ø–∏—à–µ—Ç "saved to DB"
   
![—Ç–µ—Å—Ç 1 –∫–∏–±–∞–Ω–∞.png](images/%D1%82%D0%B5%D1%81%D1%82%201%20%D0%BA%D0%B8%D0%B1%D0%B0%D0%BD%D0%B0.png)

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

‚úî Passed

#### ‚úÖ TC-02: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –ë–î

–®–∞–≥–∏:

1. –î–æ–∂–¥–∞—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Postgres
   
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å: SELECT nasa_id FROM images;

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- –ó–∞–ø–∏—Å–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è
- –ù–µ—Ç –¥—É–±–ª–µ–π

![—Ç–µ—Å—Ç 2.png](images/%D1%82%D0%B5%D1%81%D1%82%202.png)

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 

‚úî Passed

#### ‚úÖ TC-03: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

–®–∞–≥–∏:
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π nasa_id
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥ consumer

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

1. –í –ë–î –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å

![—Ç–µ—Å—Ç 3 –±–¥.png](images/%D1%82%D0%B5%D1%81%D1%82%203%20%D0%B1%D0%B4.png)

2. –í –ª–æ–≥–∞—Ö duplicate skipped

![—Ç–µ—Å—Ç 3.png](images/%D1%82%D0%B5%D1%81%D1%82%203.png)

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 

‚úî Passed

#### ‚ùóÔ∏è TC-04: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Kafka (Failover test)

–®–∞–≥–∏:

1. docker compose stop kafka
2. –ù–∞–±–ª—é–¥–∞—Ç—å –ª–æ–≥–∏ producer
3. docker compose start kafka

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

1. –ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–π Kafka producer —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏/–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫–∏.

2. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ Kafka producer –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —Å–Ω–æ–≤–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ.

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

‚ùóÔ∏è Failed 

1. Producer –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–µ—Ä–∏—é –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

[Kafka] connecting to kafka:9092 (attempt 1..10)

2. –ü–æ—Å–ª–µ —Å–µ—Ä–∏–∏ –ø–æ–ø—ã—Ç–æ–∫:

[producer] ERROR: Kafka producer not available after retries

![—Ç–µ—Å—Ç 4 —Å–µ–Ω—Ç—Ä–∏.png](images/%D1%82%D0%B5%D1%81%D1%82%204%20%D1%81%D0%B5%D0%BD%D1%82%D1%80%D0%B8.png)

3. –î–∞–ª–µ–µ —Ü–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –ø–æ–∫–∞ Kafka –≤—ã–∫–ª—é—á–µ–Ω–∞.

![—Ç–µ—Å—Ç 4 —Ä–µ—Ç—Ä–∞–π –Ω–∞ –Ω–æ–≤—ã–π id.png](images/%D1%82%D0%B5%D1%81%D1%82%204%20%D1%80%D0%B5%D1%82%D1%80%D0%B0%D0%B9%20%D0%BD%D0%B0%20%D0%BD%D0%BE%D0%B2%D1%8B%D0%B9%20id.png)

4. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è Kafka (start) –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è.

5. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ Kafka consumer-group –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ EMPTY.

–≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º:
- –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ consumer –≤ –≥—Ä—É–ø–ø–µ
- –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è rebalance

–í—ã–≤–æ–¥—ã –ø–æ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: 
1. –ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–π Kafka producer –≤—ã–ø–æ–ª–Ω—è–µ—Ç —á–∞—Å—Ç—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
   
–í –ª–æ–≥–∞—Ö –∏ Sentry –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ (—à—É–º).

3. –ü–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –∏ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ü–∏–∫–ª–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π nasa_id.
   
–ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–±—ã—Ç–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å–æ–±—ã—Ç–∏—è, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–∏–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±—Ä–æ–∫–µ—Ä–∞, –Ω–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –∏ –Ω–µ –ø–µ—Ä–µ–æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è Kafka.

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

‚ùó–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É —Å–æ–±—ã—Ç–∏–π

‚ùó —Å–æ–±—ã—Ç–∏—è, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Kafka, —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–º–∏

üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –æ—à–∏–±–æ–∫ –≤ Sentry
   
–ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–∞–∂–¥—É—é retry-–æ—à–∏–±–∫—É.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å rate limit (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 —Å–æ–±—ã—Ç–∏–µ –≤ 60 —Å–µ–∫—É–Ω–¥) –∏–ª–∏ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç.

2. –î–æ–±–∞–≤–∏—Ç—å exponential backoff
   
–í–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è 10√ó –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥—Ä—è–¥ ‚Äî —É–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (1s ‚Üí 2s ‚Üí 4s ‚Üí ‚Ä¶ –¥–æ 30s).

3. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ warning, –∞ –Ω–µ error
   
–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Kafka ‚Äî –æ–∂–∏–¥–∞–µ–º–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è, –Ω–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å retry –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —Å–æ–±—ã—Ç–∏—è –¥–æ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º backoff), —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ—Ç–µ—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±—Ä–æ–∫–µ—Ä–∞.


#### ‚úÖ TC-05: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (NASA API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

–®–∞–≥–∏:

1. –û—Ç–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç

2. –ù–∞–±–ª—é–¥–∞—Ç—å –ª–æ–≥–∏ producer

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

1. Producer –Ω–µ –ø–∞–¥–∞–µ—Ç

2. –õ–æ–≥–∏—Ä—É–µ—Ç network error

3. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç retry/backoff

4. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É

![—Ç–µ—Å—Ç 5.png](images/%D1%82%D0%B5%D1%81%D1%82%205.png)

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

‚úî Passed

#### ‚úÖ TC-06: –ü—Ä–æ–≤–µ—Ä–∫–∞ offset commit

–¶–µ–ª—å: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ commit –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –æ—à–∏–±–∫—É –≤ consumer)

1. –í `consumer.py` –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ—Å–ª–µ `ev = parse_image_event(...)` –∏ –ª–æ–≥–∞), –¥–æ–±–∞–≤–∏—Ç—å:

"
if ev.nasa_id == "TEST_FAIL":
    raise RuntimeError("Forced error for offset test (TC-06)")
"
‚ö†Ô∏è –í–∞–∂–Ω–æ: —É—Å–ª–æ–≤–∏–µ –¥–æ–ª–∂–Ω–æ —Å—Ç–æ—è—Ç—å –¥–æ consumer.commit().

2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å consumer:

docker compose up -d --build consumer

–®–∞–≥–∏:

1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Kafka topic images:

docker exec -it docker-kafka-1 bash -lc 'echo "{\"nasa_id\":\"TEST_FAIL\",\"image_url\":\"https://example.com/test.jpg\"}" | kafka-console-producer --bootstrap-server kafka:9092 --topic images'

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ consumer:

docker compose logs -f consumer

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å offsets consumer group:

docker exec -it docker-kafka-1 \
kafka-consumer-groups --bootstrap-server kafka:9092 --describe --group images-writer

1. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
Consumer –ø–æ–ª—É—á–∞–µ—Ç TEST_FAIL –∏ –ø–∞–¥–∞–µ—Ç/–ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –¥–æ commit.

2. –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ consumer —á–∏—Ç–∞–µ—Ç —Ç–æ—Ç –∂–µ TEST_FAIL —Å–Ω–æ–≤–∞.

3. –í kafka-consumer-groups --describe –≤–∏–¥–Ω–æ LAG > 0 (—Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ).

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 

‚úÖ Passed

1. Consumer –ø–æ–ª—É—á–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≤—ã–±—Ä–æ—Å–∏–ª –æ—à–∏–±–∫—É:

[consumer] received nasa_id=TEST_FAIL
[consumer] UNKNOWN error, will retry later: Forced error for offset test (TC-06)
consumer-1 exited with code 137 (restarting)

2. –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ consumer —Å–Ω–æ–≤–∞ –ø–æ–ª—É—á–∏–ª TEST_FAIL:

[consumer] started. Waiting for messages...
[consumer] received nasa_id=TEST_FAIL
[consumer] UNKNOWN error, will retry later: Forced error for offset test (TC-06)

![–õ–æ–≥–∏ –∫–æ–Ω—Å—é–º–µ—Ä —Ç–µ—Å—Ç 6.png](images/%D0%9B%D0%BE%D0%B3%D0%B8%20%D0%BA%D0%BE%D0%BD%D1%81%D1%8E%D0%BC%D0%B5%D1%80%20%D1%82%D0%B5%D1%81%D1%82%206.png)

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ offsets –ø–æ–∫–∞–∑–∞–ª–∞, —á—Ç–æ commit –Ω–µ –ø—Ä–æ–∏–∑–æ—à—ë–ª:

GROUP         TOPIC   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG
images-writer images  0          316             317             1

![—Ç–µ—Å—Ç 5 –ª–∞–≥ –∫–æ–Ω—Å—å—é–º–µ—Ä.png](images/%D1%82%D0%B5%D1%81%D1%82%205%20%D0%BB%D0%B0%D0%B3%20%D0%BA%D0%BE%D0%BD%D1%81%D1%8C%D1%8E%D0%BC%D0%B5%D1%80.png)

–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è (–≤–µ—Ä–Ω—É—Ç—å —Å–∏—Å—Ç–µ–º—É –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º):

1. –£–¥–∞–ª–∏—Ç—å/–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–æ–∫—É:

if ev.nasa_id == "TEST_FAIL":
    raise RuntimeError(...)

2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å consumer:

docker compose up -d --build consumer


#### ‚úÖ TC-07: –ü—Ä–æ–≤–µ—Ä–∫–∞ Sentry

–®–∞–≥–∏:

1. –í—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ Sentry

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

1. –û—à–∏–±–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ Sentry

2. –°–æ–¥–µ—Ä–∂–∏—Ç stack trace

3. –°–æ–±—ã—Ç–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- —Ç–∏–ø –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
- stack trace (—Ñ–∞–π–ª, —Å—Ç—Ä–æ–∫–∞, —Ñ—É–Ω–∫—Ü–∏—è)
- –≤—Ä–µ–º—è –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è
- environment=local

![—Ç–µ—Å—Ç 7.1.png](images/%D1%82%D0%B5%D1%81%D1%82%207.1.png)
![—Ç–µ—Å—Ç 7.png](images/%D1%82%D0%B5%D1%81%D1%82%207.png)
![—Ç–µ—Å—Ç 7.2.png](images/%D1%82%D0%B5%D1%81%D1%82%207.2.png)


 –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
 
‚úî Passed

 #### ‚ùóÔ∏è TC-08: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ ELK

–¶–µ–ª—å:
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∞, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–æ–≥–æ–≤ producer/consumer –≤ ELK.

–®–∞–≥–∏:
1. –û—Ç–∫—Ä—ã—Ç—å Kibana ‚Üí Discover.
2. –í—ã–±—Ä–∞—Ç—å –∏–Ω–¥–µ–∫—Å filebeat-*.
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ª–æ–≥–æ–≤ producer –∏ consumer.
4. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ:
   - container.name
   - message
   - log.level
5. –í—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –≤ Kibana.

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –õ–æ–≥–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
- –ü–æ–ª—è (@timestamp, container.name, message) –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç.
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
- –û—à–∏–±–∫–∏ –≤–∏–¥–Ω—ã –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–µ–∫—Å—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è.

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

‚ùóÔ∏è Failed

1. –õ–æ–≥–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è

2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ message —Ä–∞–±–æ—Ç–∞–µ—Ç

3. –ü–æ–ª–µ @timestamp –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç

4. –ü–æ–ª–µ container.name –Ω–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è

5. –ü–æ–ª–µ log.level –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

![—Ç–µ—Å—Ç 8.png](images/%D1%82%D0%B5%D1%81%D1%82%208.png)

6. –õ–æ–≥–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ (plain text), –ø–æ—ç—Ç–æ–º—É:

- –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É

üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ 

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ structured JSON logging –≤ Python

2. –î–æ–±–∞–≤–∏—Ç—å processor add_docker_metadata –≤ filebeat.yml

3. –Ø–≤–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å (INFO / ERROR / WARNING)

### üìä –û–±—â–∏–π –∏—Ç–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å        | –ó–Ω–∞—á–µ–Ω–∏–µ |
| ----------------- | -------- |
| –í—Å–µ–≥–æ —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤ | 8        |
| Passed            | 6        |
| Failed            | 2        |
| Blocked           | 0        |

### üìå –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã

1. –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (producer ‚Üí Kafka ‚Üí consumer ‚Üí Postgres) —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
2. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ nasa_id).
3. Offset commit —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (commit –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏).
4. Consumer –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ (at-least-once).
5. Observability –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Sentry, ELK) —Ä–∞–±–æ—Ç–∞—é—Ç.

### ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. Producer –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Kafka.
2. –°–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è –æ—Ç–∫–∞–∑–∞ –±—Ä–æ–∫–µ—Ä–∞, —Ç–µ—Ä—è—é—Ç—Å—è.
3. –ù–µ—Ç rate-limiting –æ—à–∏–±–æ–∫ –≤ Sentry (–≤–æ–∑–º–æ–∂–µ–Ω —à—É–º).
4. –õ–æ–≥–∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ (plain text).
5. –í ELK –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ log.level –∏ container.name.

### üéØ  –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–∏—Å—Ç–µ–º—ã

1. –°–∏—Å—Ç–µ–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–±–æ—è–º
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É offset
- —á–∞—Å—Ç–∏—á–Ω—É—é –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

2. –û–¥–Ω–∞–∫–æ:
- –≥–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- observability —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏
